<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #f3d0c9, #88c9bf);
            margin: 0;
            padding: 0;
        }

        .users-heading1 {
            background-color: #CBC3E3;
            color: #fff;
            padding: 10px;
            text-align: center;
            font-size: 24px;
            border-radius: 15px;
            max-width: 300px; /* Adjust this value based on your preference */
            margin: 0 auto; /* Center the heading horizontally */
        }
        .users-heading2 {
            margin: 20px;
            text-align: center;
        }

        .product-btn {
            background-color: #ADD8E6;
            color: #fff;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 5px; /* Add this line to make the buttons rounded */
        }

        .container1 {
            text-align: center;
        }

        .modal {
            background-color: #fff;
            padding: 20px;
            width: 80%;
            max-width: 400px;
            margin: 0 auto;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            align-items: center;
            justify-content: center;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-height: 600px;
            overflow-y: auto;
        }

        .close {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 24px;
            cursor: pointer;
        }

        h2 {
            text-align: center;
            color:#CBC3E3;
        }

        .form-group {
            margin: 10px 0;
        }

        label {
            display: block;
            font-weight: bold;
            color: #ff5e57;
        }

        input[type="text"],
        input[type="file"] {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 2px solid #ff6b6b;
            border-radius: 5px;
        }

        .btn-primary {
            background-color: #ff9f43;
            color: #fff;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 5px;
        }

        .container_table {
            margin: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 10px;
            text-align: left;
        }

        th {
            background: linear-gradient(to bottom, 	#CBC3E3, #90EE90);
            color: #fff;
            width: max-content;
        }

        tr:nth-child(even) {
            background: linear-gradient(45deg, 	#CBC3E3, #90EE90);
        }

        .view-btn,
        .delete-btn,
        .edit-btn {
            background-color: #ADD8E6;
            color: #fff;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            margin-right: 5px;
            border-radius: 5px;
        }
        /* Add these styles to your existing styles */
    .product-btn,
    .view-btn,
    .delete-btn,
    .edit-btn {
        transition: transform 0.3s ease-in-out;
    }

    .product-btn:hover,
    .view-btn:hover,
    .delete-btn:hover,
    .edit-btn:hover {
        transform: translateY(-3px);
    }
    </style>
</head>

<body>
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.0/jquery.validate.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

<!-- Head -->

    <div class="users-heading1">
    Admin Panel
    <span class="users-symbol">&lt;/&gt;</span>
    </div>

    <div id="imageContainer"></div>


    <div class="users-heading2">
        <td>
        <button type="button" id="product_id" class="product-btn">Add Products</button>
        <button type="button" id="admin_registration_id" class="product-btn">Register as a ADMIN</button>
        </td>
    </div>

        <!-- New Admin Registration Form -->

    <div id="admin_registration_modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Admin Registration</h2>
            <form id="admin_registration_form">
                <div class="form-group">
                    <label for="first_name">First Name:</label>
                    <input type="text" id="firstname" name="firstname">
                </div>
                <div class="form-group">
                    <label for="last_name">Last Name:</label>
                    <input type="text" id="lastname" name="lastname">
                </div>
                <div class="form-group">
                    <label for="email">Email:</label>
                    <input type="email" id="email" name="email">
                </div>
                <div class="form-group">
                    <label for="phone_number">Phone Number:</label>
                    <input type="tel" id="phone" name="phone">
                </div>
                <div class="form-group">
                    <label for="password">Password:</label>
                    <input type="password" id="password" name="password">
                </div>
                <button type="submit" id="register_admin_btn" class="btn btn-primary">Register</button>
            </form>
        </div>
    </div>

    <script>
    $(document).on('click', '#admin_registration_id', function() {
        $("#admin_registration_modal").show();
    });

    $(".close").on("click", function() {
        $("#admin_registration_modal").hide();
    });

    $(document).ready(function() {
        $("#admin_registration_form").validate({
            submitHandler: function(form) {

                $.ajax({
                    type: "POST",
                    url: "/admin_registration",
                    data: $("#admin_registration_form").serialize(),
                    success: function(response) {
                        if (response.success) {
                            alert("Admin registered successfully.");
                            $("#admin_registration_modal").hide();
                        } else {
                            alert("Admin registration failed. " + response.message);
                        }
                    },
                    error: function() {
                        alert("An error occurred during admin registration.");
                    }
                });
            }

        });
    });
</script>


{{!----------------------------------------------ADD MODAL-----------------------------------------------}}

    <div class="container1">
        <div id="product_modal" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2>ADD Products</h2>
                <form id="product_form" enctype="multipart/form-data">
                    <div class="form-group">
                        <label for="photo">Upload Photo:</label>
                        <input type="file" id="photo" name="photo">
                    </div>
                    <div class="form-group">
                        <label for="s_id">Seller's ID :</label>
                        <input type="text" id="s_id" name="s_id">
                    </div>
                    <div class="form-group">
                        <label for="p_id">Product ID :</label>
                        <input type="text" id="p_id" name="p_id">
                    </div>
                    <div class="form-group">
                        <label for="name">Name :</label>
                        <input type="text" id="name" name="name">
                    </div>
                    <div class="form-group">
                        <label for="phoneno">Category :</label>
                        <input type="text" id="category" name="category">
                    </div>
                    <div class="form-group">
                        <label for="qty">Quantity :</label>
                        <input type="text" id="qty" name="qty">
                    </div>
                    <button type="submit" id="register_btn" class="btn btn-primary"> Done </button>
                </form>
            </div>
        </div>
    </div>

<script>
    //---------------------------------------------------BUTTONS--------------------------------------------------------//
    $(document).on('click', '#product_id', function() {
    $("#product_modal").show();
});


$(".close").on("click", function() {
    $("#product_modal").hide();
});

$(document).ready(function(){
    $("#product_form").validate({
        submitHandler: function(form){
                    var s_id = $('#s_id').val();
                    var p_id = $('#p_id').val();
                    var name = $('#name').val();
                    var category = $('#category').val();
                    var qty = $('#qty').val();
                    var filedata = document.getElementById("photo");
                    const formdata = new FormData();
                    var file = filedata.files[0];
                    formdata.append("json", true);
                    formdata.append("photo", file);
                    formdata.append("s_id", s_id);
                    formdata.append("p_id", p_id);
                    formdata.append("name", name);
                    formdata.append("category", category);
                    formdata.append("qty", qty);
                    $.ajax({
                        type: "POST",
                        url: "/product_add",
                        data: formdata,
                        processData: false,
                        contentType: false,
                        success: function(response) {
                            if (response.success == true) {
                                alert("Form submitted successfully.");
                                window.location.reload();
                            } else {
                                alert(response.message);
                            }
                        }
                    });
                }
            })
        })
</script>
    {{!-----------------------------------------------------TABLE----------------------------------------------------------------}}
        <table>
            <tr>
                <th>s_id</th>
                <th>p_id</th>
                <th>name</th>
                <th>category</th>
                <th>qty</th>
                <th>photo</th>
                <th>options</th>
            </tr>
            {{#each admins}}
            <tr>
                <td>{{this.s_id}}</td>
                <td>{{this.p_id}}</td>
                <td>{{this.name}}</td>
                <td>{{this.category}}</td>
                <td>{{this.qty}}</td>
                <td><img src="{{this.photo}}" height="100px" width="100px"></td>
                <td>
                    <button type="button" id="view_id" class="view-btn" data-id="{{this.id}}">View</button>
                    <button type="button" id="delete_id" class="delete-btn" data-id="{{this.id}}">Delete</button>
                    <button type="button" id="edit_id" class="edit-btn" data-id="{{this.id}}">Edit</button>
                </td>
            </tr>
            {{/each}}
        </table>
    </div>

{{!-------------------------------------------------- V I E W --------------------------}}

<div class="container_edit">
        <div id="view_modal" class="modal" style="display: none">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2>Update User</h2>
                <form id="view_form" enctype="multipart/form-data">
                    <input type="hidden" id="view_id" name="edit_id" readonly>
                    <div class="form-group">
                        <label for="edit_s_id">Seller's ID:</label>
                        <input type="text" id="view_s_id" name="edit_s_id" readonly>
                    </div>
                    <div class="form-group">
                        <label for="edit_p_id">Product's ID:</label>
                        <input type="text" id="view_p_id" name="edit_p_id" readonly>
                    </div>
                    <div class="form-group">
                        <label for="edit_name">Product's Name:</label>
                        <input type="text" id="view_name" name="edit_name" readonly>
                    </div>
                    <div class="form-group">
                        <label for="edit_category">Category:</label>
                        <input type="text" id="view_category" name="edit_category" readonly>
                    </div>
                    <div class="form-group">
                        <label for="edit_qty">Quantity:</label>
                        <input type="text" id="view_qty" name="edit_qty" readonly>
                    </div>
                    <div class="form-group">
                        <label for="edit_photo">Photo:</label>
                        <img src="" id="view_photo" height="100px" width="100px">
                    </div>
                </form>
            </div>
        </div>
    </div>



<script>

//-----------------------------------------VIEW------------------------------------------------//

    $(document).on('click', '#view_id', function() {
        const id = $(this).data('id');
        $("#view_modal").show();
        $("#view_id").val(id);
        $.ajax({
            type:"POST",
            url:"/view-details",
            data:{id},
            success:function(response){
                console.log(response)
                const s_id = response.showdata.s_id
                $("#view_s_id").val(s_id);

                const p_id = response.showdata.p_id
                $("#view_p_id").val(p_id);

                const name = response.showdata.name
                $("#view_name").val(name);

                const category = response.showdata.category
                $("#view_category").val(category);

                const qty = response.showdata.qty
                $("#view_qty").val(qty);

                $("#view_photo").attr("src",response.showdata.photo)
            }
        })
    });
    
    $(".close").on("click", function() {
        $("#view_modal").hide();
    });

</script>





{{!-- --------------------------------------------- E D I T -----------------------------------------------}}

    <div class="container_edit">
        <div id="edit_modal" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2>Update User</h2>
                <form id="edit_form" enctype="multipart/form-data">
                    <input type="hidden" id="edit_id" name="edit_id">
                    <div class="form-group">
                        <label for="edit_s_id">Seller's ID:</label>
                        <input type="text" id="edit_s_id" name="edit_s_id">
                    </div>
                    <div class="form-group">
                        <label for="edit_p_id">Product's ID:</label>:</label>
                        <input type="text" id="edit_p_id" name="edit_p_id">
                    </div>
                    <div class="form-group">
                        <label for="edit_name">Product's Name:</label>
                        <input type="text" id="edit_name" name="edit_name">
                    </div>
                    <div class="form-group">
                        <label for="edit_category">Category:</label>
                        <input type="text" id="edit_category" name="edit_category">
                    </div>
                    <div class="form-group">
                        <label for="edit_qty">Quantity:</label>
                        <input type="text" id="edit_qty" name="edit_qty">
                    </div>
                    <button type="submit" id="save_changes_btn" class="btn btn-primary">Save Changes</button>
                </form>
            </div>
        </div>
    </div>
    



<script>

//------------------------------------------EDIT-------------------------------------//

    $(document).on('click', '#edit_id', function() {
        const id = $(this).data('id');
        $("#edit_modal").show();
        $("#edit_id").val(id);
        $.ajax({
            type:"POST",
            url:"/view-details",
            data:{id},
            success:function(response){
                const s_id = response.showdata.s_id
                $("#edit_s_id").val(s_id);

                const p_id = response.showdata.p_id
                $("#edit_p_id").val(p_id);

                const name = response.showdata.name
                $("#edit_name").val(name);

                const category = response.showdata.category
                $("#edit_category").val(category);

                const qty = response.showdata.qty
                $("#edit_qty").val(qty);
            }
        })
    });

    
    $(".close").on("click", function() {
        $("#edit_modal").hide();
    });
    
    
    
    $(document).ready(function() {
            $("#edit_form").validate({
                submitHandler: function(form) {
                    var id = $('#edit_id').val();
                    var s_id = $('#edit_s_id').val();
                    var p_id = $('#edit_p_id').val();
                    var name = $('#edit_name').val();
                    var category = $('#edit_category').val();
                    var qty = $('#edit_qty').val();       
                    $.ajax({
                        type: "POST",
                        url: "/post_edit",
                        data: {
                            edit_id:id,
                            update_firstname: s_id,
                            edit_p_id:p_id,
                            edit_name:name,
                            edit_category:category,
                            edit_qty:qty,
                        },
                        success: function(response)  {
                            if (response.success == true) {
                                alert("User updated successfully.");
                                window.location.reload();
                            } else {
                                alert(response.message);
                            }
                        }
                    })
                }
            });
        });

</script>

<script>
    //---------------------------------------------DELETE-----------------------------//
 
    $(document).on('click', '#delete_id', function() {
        const id = $(this).data('id');
       
        $.ajax({
            type: "POST",
            url: "/post_delete", 
            data: { id: id },
            success: function(response) {
                alert(response.message);
                window.location.reload();    
            },
            error: function() {
                alert("An error occurred while deleting the user.");
            }
        });
    });
</script>
</body>
</html>